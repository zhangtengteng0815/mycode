第一章：编码与数制
第二章：计算机网络概述
第三章：计算机网络体系结构
	OSI/RM体系结构
		通信子网
			物理层------二进制比特流传输
				：为所有网络/数据通信提供物理的通信线路
			数据链路层---相邻节点间的可靠传输
				：为同一局域网内部的网络/数据通信提供点对点的数据传输通道，通过MAC地址寻址把数据转到目的节点，各个网络中的数据链路层间的通信仅可以在同一网段内进行。
			网络层------寻址和路由选择
				：为不同网段之间的数据转发提供路径选择，通过IP地址把数据包转发到目的节点。“路由寻址”
				网络层的功能相当于连接不同网络的桥梁，仅起到在不同网络间转发数据包的作用。
		资源子网
			传输层------端到端的可靠传输
				：是在下面三层构建的网络平台基础上专门为通信双方构建端对端的数据传输通道，使通信双方就像直接进行数据传输一样。
			会话层------主机间会话管理
				：为具体的用户应用建立会话进程，这个过程是一个用户网络应用的协商过程。
			表示层------数据表示、压缩与加密
				：是对用户网络应用数据的具体解释，包括在网络通信时可采用的信息格式、可采用的加密方式。
			应用层------提供各种网络应用接口
				：负责为网络应用提供服务。
	TCP/IP协议体系结构
		网络访问层
		网际互联层
		传输层
		应用层
	局域网体系结构
		1.有线局域网体系结构
		2.WLAN体系结构
	计算机网络体系结构通信原理
		对等通信原理
			（1）各层上传输的数据格式PDU(protocol data unit，协议数据单元)
				物理层：比特（bit）
				数据链路层：帧（frame）
				网络层：分组（或者包，packet）
				传输层：TCP是以数据段（segment）为单位传输，UDP是以数据报（datagram）为单位进行传输的
				会话层、表示层和应用层：以具体的数据报文为单位进行传输的
			（2）协议头和协议尾的封装
第四章：物理层				
	4.1物理层概述
		4.1.1物理层主要作用
			1.构建数据通路
			2.透明传输
			3.传输数据
			4.数据编码
				不同介质所支持的数据编码类型不同（如归零码、非归零码、曼彻斯特码、差分曼彻斯特码等）
			5.数据传输管理
		4.1.2物理层所定义的特性
			1.机械特性		
				定义了传输介质接线器、物理接口的形状和尺寸、引线数目和排线顺序，以及连接器与接口之间的固定和锁定装置。
				DTE（data terminal equipment，数据终端设备）
				DCE（data communications equipment，数据通信设备）
			2.电气特性
				规定了物理连接上传输二进制比特流时线路上信号电压的高低、阻抗匹配情况，以及传输速率和传输距离限制等参数属性。
				（1）非平衡型
				（2）差分接收器的非平衡型
				（3）平衡型
			3.功能特性
				指明传输介质中各条线上所出现的某一电平的含义，以及物理接口各条信号线的用途。
			4.规程特性
				物理连接建立、维持和交换信息时，DTE/DCE双方在各自电路上的动作顺序。
	4.2数据通信基础
		4.2.1通信子网与资源子网
		4.2.2数据通信系统基本模型
			1.源系统
				源站点：产生要传输的数据的计算机或者服务器等终端设备
				发送器：对要传送的数据进行编码或者调制的设备
			2.传输系统
			3.目的系统
				目的站点：从接收器获取发送端发送来数据的计算机或者服务器
				接收器：接收从发送端发来的信息
		4.2.3数据通信的几个基本概念
			1信息
				ASCII码
			2数据
				模拟数据
				数字数据
			3.信号
				模拟信号
				数字信号
			4.信道
		4.2.4数据传输类型
			基带与频带
			基带信号与频带信号	
			基带传输与频带传输
			基带传输系统与频带传输系统
			带宽传输与带宽传输系统
		4.2.5数据传输方式
			串行传输
			并行传输	
		4.2.6数据传输模式
			同步传输
			异步传输
		4.2.7数据通信方式
			单工通信
			半双工通信
			全双工通信	
	4.3数据传输速率与信道带宽
		4.3.1传输速率与信道带宽的基本概念
			比特率：单位时间内传输的二进制代码的有效数		
			波特率：一个数字信号在被调制后，数字信号对载波的调制速率
			传输带宽：每秒传输的最大信息量
		4.3.2数字信号不失真传输的最大传输速率限制	
			奈奎斯特准则
			香农公式
		4.3.3模拟信号不失真还原的最小采样频率限制	
	4.4数字基带信号编码	
		4.4.1矩形脉冲数字信号基本波形	
			单机波形与双极波形
			归零码与非归零码
		4.4.2数字基带信号的传输码型	
			AMI码
			DHB3码
			CMI码
			曼彻斯特码
			差分曼彻斯特码
	4.5信号调制与解调
		4.5.1调制与解调的关键术语
			调制：调幅、调频、调相
			调制信号
				载波信号
				已调信号
				解调
		4.5.2ASK调制与解调
			调幅技术
		4.5.3FSK调制与解调
			调频技术
		4.5.4PSK调制与解调
			调相技术
	4.6物理层传输介质	
		4.6.1导向性传输介质
			双绞线
			同轴电缆
			光纤
		4.6.2光纤结构及主要附件
			光纤模块
			光纤连接器
			ST连接器
			SC连接器
			FC连接器
			LC连接器
		4.6.3非导向介质
			短波无线传输
			地面微波接力通信
			卫星通信
		4.7信道多路复用技术
			4.7.1频分复用及其原理
				FDM基本原理
				OFDM
			4.7.2时分复用及其原理
			4.7.3波分复用及其原理	
		4.8物理层接口
			4.8.1串行接口标准
				RS-232
				RS-422
				RS-485

第五章：数据链路层
	5.1数据链路层基础
		5.1.1划分数据链路层的必要性		
			物理链路是指物理层设备（包括传输介质、物理接口和收发器等）和相应物理层通信规程作用下形成的物理线路，
			是永久存在的，且是不可删除的。
			逻辑链路是通信双方在需要进行数据通信时，在数据链路层设备和相应的通信规程作用下建立的逻辑链路，可以是
			永远存在的（如局域网中的以太网链路），也可以不是永久存在的（如广域网中的链路），是否永久存在视具体的
			数据链路层服务类型而定。
		5.1.2数据链路层结构
			各层的SAP（service access point，服务访问点）
				物理层的PSAP是对应的物理接口
				数据链路层的DLSAP是对应物理接口的MAC地址
				网络层的NSAP是ip地址
			MAC子层（medium access control，介质访问控制）
				主要功能：数据帧的封装/卸装，帧的寻址和识别，帧的接收与发送，帧的差错控制、介质访问冲突控制等。
			LLC子层（logical link control，逻辑链路控制）	
				主要功能包括：逻辑链路的建立和释放、提供与网络层的接口、数据传输差错控制、给数据帧加上传输序列号等。
	5.2数据链路层主要功能及实现原理	
		5.2.1数据链路管理		
			数据链路层提供的服务类型
				（1）有确认的面向连接服务
					大多数广域网中通信子网的数据链路层协议采用有确认的面向连接服务。
				（2）有确认的无连接服务
					各种无线通信系统
				（3）无确认的连接服务
					在以太网中进行数据传输时接收端也不用对接收到的每一帧进行确认。
			数据链路管理
				链路建立、链路保持、链路释放
		5.2.2数据帧封装和透明传输		
			一将来自网络层的数据分组封装成数据帧
			二将来自物理层的一个个比特流组装成数据帧
			1.数据包的封装原理
			2.比特流的帧组装及透明传输原理
				字节计数法
				字符填充的首尾定界符法
				比特填充的首尾定界符法
				违法编码法
		5.2.3差错控制
			差错检测
				奇偶校验码
				循环冗余校验
			差错纠正
				反馈检测法
				自动重发请求
		5.2.4流量控制
			基于反馈的流量控制方案
			基于速率的流量控制方案
	5.3差错控制方案
		5.3.1奇偶校验码检错方案
			奇偶校验码（PPC）
		5.3.2循环冗余校验检错方案
			循环冗余校验码（CRC）
		5.3.3反馈检测法
		5.3.4空闲重发请求方案
		5.3.5连续重发请求方案
		5.3.6海明纠错码
	5.4流量控制	
		5.4.1XON/XOFF流量控制方案
			XON/XOFF（transmitter on/transmitter off，继续传输/停止传输）
		5.4.2滑动窗口机制
	
链路层协议主要有:
	局域网协议：BSC、SDLC、HDLC
	面向字符的链路层协议
		IBM 
			BSC（binary synchronous communication，二进制同步通信）
				十种通信控制符：
					ACK(acknowledge)：确认标志，由接收端发出，作为对正确接收到报文的响应
					DLE(data link escape)：转义标志，用于指示后面的字符是数据字符，而不是特殊的控制字符
					ENQ(enquire)：询问标志，用于请求远程站点给出响应。响应可能包括远程站点的身份或状态。
					EOT(end of transmission)：发送完毕标志，用于表示一个文本或多个文本的发送结束，并拆除链路
					ETB(end of transmission block)：块终止或组终止标志，用于标志每个数据块的结束位置
					ETX(end of text)：文本终止标志，由接收端发出，作为对未正确接收的报文响应
					NAK(negative acknowledge)：否认标志，由接收端发出，作为对未正确接收的报文响应
					SOH(start of head)：报头开始标志，用于表示报文的标题信息或报头的开始。仅在报文的第一个数据块中才有此标志
					STX(start of text)：文本开始标志，标志标题信息的结束和报文文本的开始。每个数据块均有此标志
					SYN(synchronous)：字符同步标志，用以实现通信双方的字符同步，或用于在无数据传输时保持同步。
				BSC传输四种格式：
					不带报头的单块报文或分块传输中的最后一块报文格式
					SYN--SYN--STX--报文--ETX--BCC
					带报头的单块报文格式
					SYN--SYN--SOH--报头--STX--报文--ETX--BCC
					分块传输中的第一块报文格式
					SYN--SYN--SOH--报头--STX--报文--ETB--BCC
					分块传输中的中间报文格式
					SYN--SYN--STX--报文--ETB--BCC
					
					BCC(block check character，块校验字符)
					CRC(循环校验码)
		DEC 
			DDCMP（digital data communication message protocol，数字数据通信协议）
			SLIP（serial line Internet protocol，串行线路网际协议）
			PPP（point-to-point protocol，点对点协议）
				链路层控制协议（link control protocol，LCP）:用于建立、配置、测试和管理数据链路连接
				网络控制协议（network control protocol，NCP）:协商该链路上所传输的数据包格式与类型，建立、配置不同的网络层协议
				口令认证协议（password authentication protocol，PAP）和质询握手认证协议（challenge-handshake authentication protocol，CHAP）:
					为PPP连接提供用户认证功能，可以确保PPP连接的安全性
				派生协议
					PPPoE(PPP over Ethernet)
					PPPoA(PPP over ATM)
				帧格式与透明传输
					标志（flag）：标志帧的起始或结束
					地址（address）：标志对方节点地址
					控制（control）
					协议（protocol）
					信息（information）
					帧校验序列（FCS）
				
	面向比特的链路层协议
		IBM
			SDLC（synchronous data link control，同步数据链路控制）
		ANSI
			修改SDLC提出ADCCP（advanced data communication control procedure，高级数据通信控制规程）
		ISO
			修改SDLC提出HDLC（high-level data link control，高级数据链路控制）
		CCITT
			修改HDLC提出LAP（link access procedure，链路访问规程）
		
	5.8数据链路层主要网络设备
		5.8.1计算机网卡
			有线以太网卡
			WLAN网卡
		5.8.2网桥及其工作原理
		5.8.3二层交换机概述
			交换机是集线器和网桥的升级替代产品
		5.8.4二层交换原理
			1CAM表的建立
				数据帧的转发是依据目的MAC地址查询CAM表，而CAM表的学习则是以源MAC地址为依据的。
				
				（1）交换机在接收到数据帧时会把其中的源MAC地址提取出来，查询CAM表是否有针对该MAC地址的转发项，若没有，则把MAC地址
				和接收到该MAC地址的端口绑定起来，插入CAM表项，这样当接收到一个发送该MAC地址的数据帧时，就不需要想所有端口广播。
				（2）在接收到数据帧中目的MAC地址未知的情况下，通过向交换机其他端口进行广播，接收广播帧的节点应答广播帧后，便获得原来数据
				帧中对应的目的MAC地址所连接的端口，这时交换机又会把该MAC地址与所连端口的对应表项插入到CAM表中。
				
第六章：介质访问控制子层（MAC子层）		
	6.1MAC子层基础
		是有线局域网体系结构和WLAN体系结构中数据链路层的一个子层。
			作用1：用来寻址（这里是MAC地址），也就是寻找目的节点。
			作用2：用来解决网络中多用户争抢共享介质或者共享信道的现象。
		6.1.1两种信道类型
			点对点信道
			广播信道
		6.1.2MAC子层概述
			MAC子层主要功能包括MAC帧的封装和拆卸，实现和维护各种MAC协议，比特流差错检测，MAC寻址等。
		6.1.3介质争用综述
	以太局域网使用CSMA和CSMA/CD原理，WLAN使用CSMA/CA原理
	6.2CSMA介质访问控制原理
		6.2.1非-坚持算法
			各站点不连续侦听总线介质是否空闲，即在发现介质忙时，先停止侦听，等过一段时间再来侦听。
		6.2.2 1-坚持算法
			发现总线介质忙时一直持续不断侦听，直到发现介质处于闲状态。
		6.2.3p-坚持算法
			侦听到介质处于忙状态时持续侦听，当侦听介质处于空闲状态时，此站点不一定马上发送数据，根据概率p选择。
	6.3CSMA/CD介质访问控制原理
		6.3.1综述
		6.3.2冲突检测原理
		6.3.3冲突避让原理
			截断二进制指数退避算法
		6.3.4不足
			当一个站点要发送大量数据时，会出现一个站点长时间控制LAN情形。
	6.4局域网标准及以太网帧格式
		6.4.1 IEEE 802系列局域网标准
		6.4.2以太网帧格式综述
			来自网络层的数据包到达数据链路层后要经过LLC和MAC这两个子层的两次封装。
			MAC帧把整个LLC帧当成Data字段，然后加上自己的MAC帧头和帧尾构成MAC帧。
		6.4.3以太网LLC帧头部格式
		    DASP:目的服务访问点
		    SSAP:源服务访问点
		    控制:control字段
		6.4.4以太网SNAP头部字段
		    LLC扩展部分
		        OUI:组织唯一标识
		        TYPE:类型字段--指示帧中数据字段报所对应协议类型，支持802.3、802.4、802.5、802.11等协议以及其他非802协议。
        6.4.5以太网MAC帧
            前导
            帧起始
            目的MAC地址、源MAC地址
            长度、类型
            Data
		    frame checksequence帧校验序列
    6.5标准以太网规范及体系结构
        6.5.1标准以太网规范
            命名规范：
                <数据传输速率（Mbps）><信号传输模式><最大段长度（百米）>
                例子：10Base-5：10Mbps，Base表示信号采用基带传输方式，500m
            （1）10Base-5和10Base-2
            （2）10Base-36
            （3）10Base-T
            （4）10Base-F
        6.5.2标准以太网物理层结构
            在以太网中，MAC子层是直接与物理层连接的。
            （1）介质连接单元
                MAU（medium attachment unit，介质连接单元）：是网络接口用来直接与传输介质（如同轴光缆，双绞线，光纤等）连接的那部分结构，
                发挥的作用是里面的收发器芯片。其包括了PMA（physical medium attachment，物理介质连接）和介质相关接口（medium dependant interface，MDI）
                两个子层的功能，在网络接口和传输介质之间提供机械连接和电气特性接口。
                MDI负责处理网络接口与传输介质的连接，其实就是网络接口连接器。
                PMA向PLS子层提供服务，负责处理与物理介质连接方面的功能（在收发器中实现），如串/并行传输的转换，检测冲突，超时控制以及收发比特流。
            （2）连接单元接口
                AUI（attachment unit interface，连接单元接口）相当于网络接口收发器上的电缆。定义了将MAU与PLS子层相连的电缆机械和电气特性，
                同时还定义了通过这个电缆所交换的信号的特性。
            （3）物理层信号子层
                PLS（physical layer signaling，物理层信号）为MAC子层服务，是网卡中实现的（PMA和MDI是在收发器中实现的）。
                    编码/解码：发送时将MAC子层来的串行数据编码为曼彻斯特编码，并通过收发器电缆发送给收发器；
                            接收时，接受AUI发送来的曼彻斯特编码信号，并进行解码，然后以串行方式发送给MAC子层。
                    载波侦听：确定介质是否空闲，然后把侦听到的载波侦听信号发送给MAC子层。
     6.6快速以太网规范及体系结构
		6.6.1快速以太网规范
		    100Base-TX:100Mbps-Base表示基带传输-TX表示两对双绞线
		    100Base-T4:四对双绞线
			100Base-FX:两条光纤
		6.6.2快速以太网物理结构
            （1）介质相关接口子层(MDI)
            （2）物理介质相关子层(PMD,physical media dependent)
                提供信号收发、检测和编解码等功能。
			（3）物理介质连接子层(PMA)
			（4）物理编码子层(PCS,physical coding sublayer)
			    主要功能：4B/5B编解码、碰撞检测和并串转换
			（5）介质无关接口(MII,medium independent interface)
			    与10Mbps以太网的AUI接口对应。由原来标准以太网AUI的一位位的串行传输变为半字节的并行传输。
			（6）协调子层(RS,reconciliation sublayer)
			    替换原来的PLS，作用将MAC的业务定义映射成MII接口信号。
	6.7千兆以太网规范及体系结构
	    6.7.1千兆以太网规范
			基于光纤
			    （1）1000Base-LX
			    （2）1000Base-SX
			    （3）1000Base-LH
			    （4）1000Base-ZX
			    （5）1000Base-LX10
			    （6）1000Base-BX10
            基于双绞线
                （1）1000Base-CX
                （2）1000Base-T
                （3）1000Base-TX
        6.7.2 1000Base-T技术
        6.7.3IEEE千兆以太网物理层结构
            GMII的发送由原来的MII的半字节（4位）扩展到一字节（8位）
    6.8万兆以太网规范及体系结构
    6.9 IEEE802.1d协议
        IEEE802.1d及STP(spanning tree protocol，生成树协议)
        6.9.1理解网络环路
            二层环路：在二层交换网络中，网络广播信息在网络中形成的一个封闭环路。
            三层环路：指当原路意外不能工作时，造成路由通告错误形成的一个恶性路由循环。
        6.9.2STP简介
            STP将两点之间的多条路径划分为通信链路和备份链路，并规定数据转发只在通信链路上进行，而备份链路只用于链路侦听，当通信链路失效时，才自动切换到备份链路。
            通信链路往往是最短的路径。
        6.9.3STP的基本工作原理
            一：通过选举使得交换网络中的各个交换机处于特定的角色，位于树根的核心交换机，位于树干的汇聚交换机，位于树枝的接入交换机，这样可以使得整个交换网络拓扑结构呈一个树形结构。
            二：把交换机间连接的端口划分为不同的角色，各个交换机端口又可以设为几种状态，使得可能形成环路的交换机端口在正常工作时处于阻塞状态，同时指定每个交换机与上级交换机连接的固定端口。
        6.9.4STP的不足和增强技术
            二层数据网的收敛时间过长
            网络拓扑容易引起全局波动
            缺乏对现有多VLAN环境的支持
    6.10 IEEE802.1q协议
        VLAN(virtual local area network，虚拟局域网)对应的技术标准IEEE802.1q
        6.10.1划分VLAN的目的
            将大的交换网络划分成多个小的交换网络。
        6.10.2理解VLAN的形成和工作原理
            同一物理交换机中的VLAN
            不同物理交换机中的VLAN
                中继：一台交换机上的VLAN配置可以传播、复制到网络中相连的其他交换机上，这就是VTP(VLAN中继协议)
                中继端口（trunk）：指一个交换机端口允许一个或多个VLAN通信到达网络中相连的另一台交换机上相同的VLAN中
            VLAN互访
                VLAN是二层协议，VLAN的虚拟或者逻辑属性决定了这些VLAN之间没有物理二层连接（只有逻辑连接），彼此独立，相当于一个个独立的二层交换网络。
                在不可能进行二层互访的情况下，可以通过三层解决它们之间的连接问题。
        6.10.3 IEEE802.1q帧头部格式
            TPID:Tag protocol Identifier（标签协议标志符）表明这是一个添加了IEEE802.1q标签的帧
            priority:user priority（用户优先级）用于当交换机阻塞时，优先发送哪个数据帧，也就是QoS(服务质量)的应用
            CFI:canonical format Idicator（标准格式指示器）用来兼容以太网和令牌环网。用来标识MAC地址在传输介质中是否以标准格式进行封装
            VLAN ID:VLAN Identified（VLAN标识）指明VLAN的ID
    6.11 IEEE802.1w协议
        快速生成树协议（rapid spanning tree protocol，RSTP）,作为对IEEE802.1d协议的补充
        RSTP的主要改进
            （1）为根端口和指定端口设置了快速切换用的替换端口和备份端口两种角色。当根端口或指定端口失效时，替换端口就会无延时进入状态。
            （2）在只连接了两个交换端口的点对点链路中，指定端口只需与下级交换机进行一次握手就可以无延时进入转发状态。
            （3）把直接与终端相连而不是与其他交换机相连的端口定义为边缘端口。边缘端口可以直接进入转发状态，不需要任何延时。
        RSTP的不足
            （1）整个交换网络只有一颗生成树，在网络规模比较大的时候会导致较长的收敛时间，拓扑改变的影响面较大
            （2）在网络结构不对称的时候，单生成树就会影响网络连通性
            （3）在链路被阻塞后将不承载任何流量，造成极大浪费
    6.12 IEEE802.1s协议
        6.12.1  MSTP简介
            MSTP(multiple spanning tree protocol，多生成树协议)
            MSTP允许通过VLAN中继来构建多个生成树，可以组合和关联多个VLAN到生成树实例。每个实例有一个独立于其他生成树实例的拓扑。这种架构为数据通信和负载提供了多个转发路径。
            MSTP建立、管理两种生成树类型：
                （1）IST(internal spanning tree，内部生成树)是在MST区域中运行的生成树总称。
                （2）CST(common spanning tree，公共生成树)是互联不同MST区域的单生成树实例。
                （3）CIST(common and internal spanning tree，公共和内部生成树)是MST区域中所有IST、连接MST区域的CST和其他SST的集合。
        6.12.2 MST区域及工作原理
    6.13 IEEE 802.1x协议
        IEEE 802.1x协议：定义了一个C/S模式的访问控制和认证协议，以阻止未授权客户端通过公共访问端口连接LAN。
        6.13.1 IEEE 802.1x认证设备角色
            客户端
            认证服务器
            交换机
        6.13.2 IEEE 802.1x主机模式
            主机模式决定了在该端口上连接了多个客户端时是否允许多个主机被认证
            1.单主机模式
            2.多主机模式
            3.多域认证模式
            4.多认证模式
            5.预认证开放访问
        6.13.3 IEEE 802.1x认证流程
    6.14 主要WLAN标准与技术
        WLAN采用的是802.11系列规范
        6.14.1 IEEE802.11b规范
        6.14.2 IEEE802.11a规范
        6.14.3 IEEE802.11g规范
        6.14.4 IEEE802.11n规范
        6.14.5 新规范
            IEEE802.11ac
            IEEE802.11ad
        6.14.6 其他主要WLAN规范
            IEEE802.11e
            IEEE802.11i
            IEEE802.11f
            IEEE802.11h
        6.14.7 WLAN MAC帧格式
            MAC子层有两种工作方式：分布式协调功能（DCF）和点协调功能（PCF）
            (1)Frame Control（FC，帧控制）字段
                protocol version：协议版本字段
                type：帧类型字段
                subtype：帧子类型字段
                to ds：到分布式系统的帧字段
                from ds：来自分布式系统的帧字段
                more fragment：更多分片字段
                retry：重传字段
                pwr mgt：power management，电源管理字段
                more data：更多数据字段
                wep：加密字段
                order：顺序字段
            (2)Duration/ID 持续时间字段
            (3)Address 地址列表字段（MAC地址）
                对应：接收者地址、发送者地址、源地址、目标地址
            (4)Sequence Control 序列控制字段
                由分段号和序列号组成，用于表示同一帧中不同分段的顺序，并用于识别数据包副本。
            (5)Data 数据字段
                发送或接收的信息。
            (6)Frame Check Sum 帧校验序列

第七章：网络层
    7.1网络层概述
        网络层用来连接不同局域网线路的结点，位于不同网络的边缘，相当于各个城市的边缘，用于连接不同交通线路的中转站点一样。
        7.1.1划分网络层的必要性
            主要作用：实现两个网络系统之间数据透明传送，具体包括路由选择、拥塞控制和网际交互等。

            局域网内部的用户访问也是需要寻址的，即通过MAC地址（又称硬件地址）。

            物理层传输是一个个比特位
            数据链路层传输的是一个个以许多字节为单位的帧，每个帧的帧头都有源节点MAC地址和目的节点MAC地址，局域网内部的寻址就是通过MAC地址进行的。
            网络层中传输的是数据包，一个数据包是一个数据帧经过网络层协议重新封装后得到的，每个数据包都有源节点IP地址和目的节点IP地址。网络间寻址就是通过IP地址进行的。
        7.1.2网络层主要作用
            （1）屏蔽网络差异，提供透明传输
                网络层提供的服务有两类：面向连接的网络服务和无连接的网络服务。
            （2）为网络间通信提供路由选择
            （3）数据包封装和解封装
            （4）拥塞控制
    7.2网络层数据交换及相关技术
        7.2.1线路交换
            是最原始的数据交换方式，是在网络中利用可切换的物理通信线路直接连接通信双方所进行的一种数据交换方式，最常见的是电话交换系统。

            面向连接，在数据交换之前，需要在通信子网中建立一个实际的物理线路连接。
            线路交换的主要特点是在数据交换前需要在一对用户之间建立一条专用的数据通路，在整个数据传输过程中要经过线路建立、数据传输与线路释放三个阶段。
        7.2.2存储-转发
            （1）报文交换
                信息以报文（完整数据的一个信息段）为单位进行存储-转发的一种数据交换方式。
            （2）分组交换
                一种是采用路由技术，在要转发的数据包头部加上源节点和目的节点的IP地址，然后通过路由技术一级一级转发。这种分组交换技术就是数据报服务，其中分组称为数据报。

                一种在进行数据分组前先在源节点和目的节点间的所有路由器间建立一条虚拟的通信通道，然后再把数据分组从这个虚拟通道中转发到目的节点。这种分级交换技术就是虚电路服务，
                所建立的虚拟通道称为“虚电路”。采用虚电路方式进行分组交换的典型实例就是通过ADSL拨号连接ISP网络。

                分组交换结合报文交换和线路交换两种交换方式。
                通过数据报这种服务方式为每个分组都添加了报文号、分组号、目的地址、源地址和校验字段信息。
                采用虚电路这种服务方式的分组无须添加源和目的地址信息，但仍需要添加报文号、分组号信息。
        7.2.3虚电路分组
            （1）建立虚电路
            （2）传输数据
            （3）拆除虚电路
                --建立逻辑连接非物理连接

            特点：
                分组交换前建立逻辑连接。
                通信通过虚电路顺序传送，有固定的交换路径，每个分组均不必带目的地址、源地址等信息。
                分组通过每个节点时，只需做差错检测而不要做路径选择。
                通信子网中每个节点可以和任何节点建立多条虚电路连接，每条物理线路可以建立无数条虚电路连接。
        7.2.4数据报分组交换
            数据报就是在数据前部增加了源地址和目的地址信息字段的报文分段。

            原理：
            （1）当某个端系统要发送报文时，先将报文拆分成若干个带有序号和地址信息的数据报，然后依次发给网络节点。
            （2）各个节点可根据数据报中所包括的地址和路由信息，选择不同的路由路径进行发送。另外，各个节点也可能随时根据网络流量、故障等情况选择最佳路径。
        7.2.5虚电路交换和数据报交换比较
            （1）传输方式上的区别
                虚电路：需在源、目的主机之间正式进行数据交换前建立逻辑连接；通信完成后，释放对应逻辑连接
                数据报：无须建立连接，直接根据路由信息进行数据交换
            （2）数据格式的区别
                虚电路：仅在源主机发出呼叫分组中需要填上源和目的主机的IP地址，在数据传输阶段，各分组都只需填上虚电路号和分组号。
                数据报：每个数据报中都必须添加源地址和目的地址
            （3）转发路径的区别
                虚电路：每个分组都沿着相同的路径进行转发，无须进行路径选择。
                数据报：每个节点都进行一次路径选择，转发路径也可能不一样。
            （4）可靠性方面区别
            （5）适应性方面区别
            （6）拥塞控制能力方面的区别
    7.3网络层协议及报文格式
        IPv4协议簇：
            IP(Internet protocol，因特网协议)
            ARP(address resolution protocol，地址解析协议)
            ICMP(Internet control message protocol，因特网控制消息协议)
        IPv6协议簇：
            IPv6
            ICMPv6
            ND(neighbor discovery，邻居发现协议)
            MLD(multicast listener discover，组播侦听发现协议)
        7.3.1 IP协议基本功能
            IP协议主要功能：
                （1）寻址
                （2）数据报的封装
                （3）分段与重组
        7.3.2 IPv4的不足
            （1）IPv4地址空间面临枯竭
            （2）骨干路由器维护的路由表表项数量过多
            （3）地址结构不合理
            （4）配置复杂
            （5）服务质量差
            （6）不支持端到端安全
        7.3.3 IPv6的主要优势
            （1）更大地址空间
            （2）有效和分级的寻址及路由基础结构
            （3）支持无状态和控制状态的地址配置
            （4）对服务质量（QoS）的更好支持
            （5）提供用于邻近节点交互的新协议
            （6）可扩展性
            （7）支持移动特性
        7.3.4 IPv4数据报头部格式
            （1）版本（version）
            （2）头部长度（header length）
            （3）区分服务（differentiated services）
                服务类型（ToS）字段，用于表示数据报的优先级和服务类型
                包括3位长度的优先级、4位长度的标志位
                标志位分别为D(delay，延迟),T(throughput，吞吐量),R(reliability，可靠性),C(cost，开销)，分别表示包延迟、吞吐量、可靠性和开销值。
            （4）总长度
                IP数据报总长度
            （5）标识
                数据报唯一标识
                相同的标识字段的值使分段后的各数据报分段最后能正确的重装成为原来的数据报
            （6）标志
                指出IP数据报后面是否还有分段
                最低1位记为MF(more fragment)，MF=1表示后面还有分段，MF=0表示这是数据报的最后一个分段
                中间1位记为DF（dont fragment），DF=1表示不允许分段，DF=0表示允许分段
            （7）段偏移
                指出该分段在数据报中的相对位置
            （8）生存时间
                用来标识IP数据报在网络中传输的有效期
                TTL指数据报允许经过的路由器个数
            （9）协议
                标识此IP数据报在传输层所采用的协议类型（TCP/UDP/ICMP等）
                以便使目的主机的IP层知道应该将数据部分上交给哪个处理过程
            （10）校验和
                用来检验IP数据报的报头部分是否发生变化
            （11）源地址、目的地址
            （12）选项
                提供扩展余地
        7.3.5 IPv6数据报头部格式
            （1）版本
            （2）通信分类
            （3）流标签
                标记报文的数据流类型
            （4）有效载荷长度
            （5）下一个头部
                标识当前报头（或扩展报头）的下一个头部的类型
            （6）跳数限制
                指定报文可以有效转发的次数
            （7）源IP地址
            （8）目的IP地址
        7.3.6 IPv6拓展报头
            （1）逐跳选项头
                此扩展报头须被转发路径所有节点处理
            （2）目的选项头
                实现移动漫游
            （3）路由头
                用于源路由选项和移动IPv6
            （4）分段头
                用于标识数据报的分段
            （5）认证头
                用于IPSec，提供报文验证、完整性检查
            （6）封装安全有效荷头
                用于IPSec，提供报文验证、完整性检查和加密
            （7）上层头
                标记上层协议类型，如TCP,UDP,ICMP等
        7.3.7 IPv4数据报封装与解封装
            IP数据报无论经过多少网络，整个数据报内容都不会改变，包括包头部分的源和目的地址信息。
            变化的只是在不同网络数据链路上传输的帧头信息，即在不同网络链路上传输的源MAC地址会改变，目的MAC地址不会改变。
        7.3.8 IPv4数据报的分段与重组
            MTU（最大传输单元）
            IP数据报分段后应该在每个分段中加上对应的IP包头信息。
            还需要在每个分段的包头部分对标志字段和段偏移字段进行对应的修改。
        7.3.9 ARP协议报文格式及ARP表
            地址解析协议：将IP地址解析为以太网MAC地址的协议。
            （1）报文格式
                硬件类型
                    值为1时表示为以太网地址
                上层协议类型
                    表示硬件地址要映射的协议地址类型，映射IP地址时的值为0x0800
                MAC地址长度
                IP协议地址长度
                操作类型
                    1表示ARP请求报文，2表示ARP应答报文
                源MAC地址
                源IP地址
                目的MAC地址
                目的IP地址
            以太网帧头的三个字段说明
                目的MAC地址
                    如果是ARP请求帧，因为是一个广播帧，所以要填上广播MAC地址——FF-FF-FF-FF
                源MAC地址
                    节点MAC地址
                帧类型
            （2）ARP映射表
                动态ARP表项
                    ARP报文自动生成和维护。
                静态ARP表项
                    长静态ARP表项
                        配置IP地址和MAC地址，还要配置ARP表项对应的VLAN（虚拟局域网）和出接口
                    短静态ARP表项
                        配置IP地址和MAC地址
                        如果出接口是三层以太网接口，可以直接用于报文转发
                        如果出接口是VLAN虚接口，则不能用于报文转发
        7.3.10 ARP地址解析原理
            当要发送IP数据包时，先发送ARP请求报文。
        7.3.11 ICMP协议及报文格式
            Internet控制报文协议。用于IP主机、路由器之间传递控制消息。
            控制消息指网络通不通、主机是否可达，路由是否可用等网络本身的消息。

            ICMP报头格式
                类型
                   标识ICMP报文类型。分为两大类：第一类1-127的差错报文，第二类128以上的信息报文。
                代码
                    标识对应ICMP报文的代码
                校验和
                    以校验报文在传输过程中是否出现的差错
                标识
                    用于标识ICMP进程。

            常见的ICMP报文
                （1）响应请求
                    ping操作的响应（类型字段为8）和应答ICMP（类型字段为0）报文
                （2）目标不可到达、源抑制和超时报文
                    目标不可到达（类型为3）：常见有网络不可达（代码字段为0）、主机不可达（代码字段为1）、协议不可达（代码字段为2）
                    源抑制（类型为4，代码字段为0）
                    超时报文（类型为11）：代码字段为0表示传输超时，代码字段为1表示重组分段超时
                （3）时间戳请求报文（类型为13）和时间戳应答报文（类型为14）：用于测试两台主机之间数据报来回一次的传输时间。
        7.3.12 IPv6协议簇的其他协议
            ICMPv6取代ICMP：诊断功能
            MLD取代IGMP：多组播成员身份
            ND取代ARPND：管理相邻节点间的交互，包括自动配置地址和将下一跳跃点IPv6地址解析为MAC地址
    7.4 路由和路由算法
        7.4.1 路由分类
            静态路由
                （1）手动配置
                （2）路由路径固定不变
                （3）不可通告性
                （4）单向性
                （5）接力性
                （6）优先级较高
                （7）适用于小型网络
            动态路由
                （1）自动生成
                （2）自动调整
                （3）自动通告
                （4）自动生成双向路由
                （5）仅可生成网络间的路由表项
                （6）不同动态路由不兼容
        7.4.2 路由算法基础
            非自适应路由算法：不能根据网络流量和拓扑结构变化更新路由表，仅使用静态路由表的路由算法，又称为固定式路由选择算法。
                （1）静态路由
                    由管理员手动添加路由表项
                （2）扩散法
                    向所有接口进行复制扩散，适用于网络规模小、通信负载轻、可靠性要求极高的通信场合。
                （3）随机走动发
                    向与之相邻的节点中随机选择一个将分组转发出去。不是最佳路径、通信效率低、分组传输延迟不可预测
                （4）最短路径法
                    将源节点到网络中所有节点的最短通路都找出来，作为这个节点的路由表
                （5）基于流量的路由算法
                    先知道网络拓扑结构、节点之间的平均流量、各条线路的容量，然后在此基础上采用适当的选择算法，找出最佳路由。
            自适应路由算法：可根据网络流量和拓扑结构的变化更新路由表。
                分散式路由算法
                    （1）距离矢量路由算法
                        对应路由条目中源和目的站点间的距离（跳数）。从本节点起，每经过一个路由器加一跳。
                        采用该算法的协议：
                            RIP--最多15跳
                            IGRP(内部网关路由协议)--最大255跳
                            EIGRP(增强型内部网关路由协议)--最大255跳
                            BGP(边界网关协议)--没有最大跳
                总体式路由算法
                    （2）链路状态算法（最短路径算法）
                        不仅要根据经过的路由器数量，还要根据路径中各段链路的状态来计算最佳路径
                        协议包括：
                            OSPF(开放最短路径优先)
                            IS-IS(中间系统到中间系统)
                            EIGRP
                    （3）分级路由算法
                        路由器被分成很多组，称为区域。各个路由器都有自己的所在区域路由器信息，而没有其他区域的路由器信息。
                        在其路由表中，路由器只需要存储其他每个区域的一条记录。
                        协议包括：
                            OSPF(开放最短路径优先)
                            IS-IS(中间系统到中间系统)
                            BGP
                            区域内部采用了距离矢量或者链路状态路由算法，在整个网络中，还是要采用分级路由算法。
        7.4.3 路由表基础
            存储着指向特定网络地址的路径
            每个静态路由表项包括：
                网络：目的地址的网络IP地址
                子网掩码：用来判断目的ip所属的网络。
                下一跳地址/接口
        7.4.4 路由优先级
            管理距离：是指一种路由协议的路由可信度，值为0-255，值越低优先级越高，可信度越高。
        7.4.5 路由算法设计目标和设计考虑
            正确性、简单性、健壮性、稳定性、公平性、最优性和灵活有效性
    7.5 几种主要路由算法解析
        7.5.1 最短路径路由算法
        7.5.2 扩散算法
        7.5.3 距离矢量路由算法
        7.5.4 链路状态路由算法
    7.6 网络拥塞控制方法和原理
        7.6.1 网络拥塞控制方法
            缓冲区预分配法：常用于虚电路分组交换网中。
            分组丢弃法
            定额控制法
        7.6.2 死锁及其预防
            存储转发死锁及其预防
            重装死锁及其预防
    7.7 网络设备及主要技术
        7.7.1 路由器主要硬件技术
            硬件体系结构：包处理性能及可编程性
            ASIC技术：包转发、查路由
                路由计算、控制等非实时任务由CPU运行软件完成，数据转发等实时任务由ASIC完成
            分布式处理技术
            交换式结构和调度算法
            路由表硬件查找
            高密度和多端口
            光路由器技术
        7.7.2 路由器主要软件技术
            VPN技术：在公用网络上建立虚拟私有网的一种新兴网络技术。
            QoS技术：服务质量，利用IP传输多媒体信息
                数据包分类技术
                数据流的分类
                RSVP（资源预留协议）技术
                DiffServ技术
            MPLS技术：将IP的灵活性和帧中继、ATM等面向连接网络的QoS保证特性有效结合在一起。
            多播技术：应用于视频会议等，这种应用需要同一份数据同时发送给多个用户。
                IGMP（Internet组管理协议）用于控制用户加入或者离开多播组。
                多播路由协议用于建立多播路由表
            网管系统：网管协议
                SNMP(简单网络管理协议)、RMON(远程镜像)
                作用包括：收集路由器统计数据和状态信息，回答网管站对这些信息的查询；传达网管站的设置命令，如TCP连接复位、 配置端口IP地址、发生异常事件时主动向网管站报告等。
        7.7.3 三层交换机
            大多数三层交换机采用ASIC硬件芯片来完成转发，ASIC芯片内部集成了IP三层转发的功能。
            包括检查IP报文头、修改存活时间（TTL）参数、重新计算IP头检验和、封装IP包的数据链路等。
        7.7.4 三层交换机硬件结构
            纯硬件模块
            纯软件模块
            软硬结合模块
                在ASIC芯片中同时存储二层CAM表和三层转发表
                在内存中存储软件路由表和ARP表，由CPU调用。
        7.7.5 三层交换原理
        7.7.6三层交换示例
        7.7.7三层交换机和路由器的主要区别
            （1）三层功能实现机制不同
            （2）适用环境不同
            （3）多协议支持能力不同
            （4）路由能力不同

第八章 IP地址和子网
    8.1 IPv4地址
        8.1.1 IPv4地址基本格式
        8.1.2 子网掩码
            子网掩码有五种
                0.0.0.0：表示任意网络的掩码，如果我们设置路由时，不仅IP地址为0.0.0.0，子网掩码也为0.0.0.0
                255.0.0.0：A类地址默认子网掩码
                255.255.0.0：B类地址默认子网掩码
                255.255.255.0：C类地址默认子网掩码
                255.255.255.255：单一主机网络，代表这个网络就是一个IPv4地址，在配置ACL（访问控制列表）时，如果控制的是一台主机，则对应的子网掩码也为255.255.255.255
        8.1.3 IPv4地址基本分类
            A类IPv4地址
                网络ID全为0的地址为保留地址，不能被分配；
                网络地址ID为127的地址专用本地环路测试，也不能分配；

                主机ID全为0的地址为网络地址；
                主机ID全为1的地址为广播地址；
            B类IPv4地址
                主机ID全为0的地址为网络地址；
                主机ID全为1的地址为广播地址；
            C类IPv4地址
                最高两位固定分别为110

                主机ID全为0的地址为网络地址；
                主机ID全为1的地址为广播地址；
            D类IPv4地址
                组播地址
                组播时源主机只需发送一份数据，就可以使对应组播组中的一个或多个主机收到这份数据的副本的通信方式，但只有组播内的主机可以接收该数据。
                范围224.0.0.0-239.255.255.255

                (1)预留组播地址
                    不分配给特定用户使用，仅为公用的组播路由协议分配使用的组播地址，地址范围224.0.0.0-224.0.0.255
                    协议IGMP（Internet组管理协议）、CGMP（Cisco组管理协议）、IGMP snooping（IGMP侦听）、PIM（协议无关组播）

                    在这个地址段中224.0.0.0不分配；224.0.0.1分配给本地组播网络所支持组播的主机；224.0.0.2分配给本地组播网络中所有组播路由器；
                    224.0.0.4分配给本地组播网络中所有DVMRP路由器；224.0.0.5分配给本地组播网络中所有OSPF路由器；224.0.0.6分配给本地组播网络中
                    所有OSPF指定路由器（DR）；224.0.0.9分配给本地组播网络中的所有RIPv2路由器；224.0.0.10分配给本地组播网络中的所有IGRP路由器；
                    224.0.0.13分配给本地组播网络中的所有PIMv2路由器；224.0.0.22分配给本地组播网络中所有的IGMPv3路由器。
                (2)公用组播地址
                    224.0.1.0-224.0.1.255
                (3)临时组播地址
                    224.0.2.0-238.255.255.255
                    在局域网内部使用的组播地址。
                (4)本地管理组播地址
                    239.0.0.0-239.255.255.255
                    专用于局域网内部测试
            E类IPv4地址
                范围240.0.0.0-247.255.255.255
        8.1.4 有类、无类IPv4网络
            VLSM(variable length subnet masking，可变长子网掩码)
                用户可以根据网络规模大小选择拥有适当可用IPv4地址的IPv4地址段，这样可以减少IPv4地址的闲置和浪费，降低广播风暴产生的可能。
                可以提高路由效率
                提高广域网中的网络安全
        8.1.5 网络地址、主机地址和广播地址
            网络地址：主机ID部分全为0的IPv4地址
            广播地址：主机ID部分全为1的IPv4地址
            主机地址：中间其他所有地址

            单播：指一台源IP主机与一台目的IP主机进行通信的方式
            组播：指一台源IP主机同时与网络中多台IP主机进行通信的方式，又称多播。组播使用组播地址，D类地址。
            广播：指一台源IP主机同时与本地网络或子网络所有其他节点进行通信的方式。

            例子：
                192.168.1.0/24网络--网络地址192.168.1.0/24，广播地址192.168.1.255/24

                将其划分为四个子网
                192.168.1.0-192.168.1.63（192.168.1.0/26）网络地址192.168.1.0/26，广播地址192.168.1.63/26
                192.168.1.64-192.168.1.127（192.168.1.64/26）网络地址192.168.1.64/26，广播地址192.168.1.127/26
                192.168.1.128-192.168.1.191（192.168.1.128/26）网络地址192.168.1.128/26，广播地址192.168.1.191/26
                192.168.1.192-192.168.1.255（192.168.1.192/26）网络地址192.168.1.192/26，广播地址192.168.1.255/26

            广播地址
                网络广播地址：标准有类网络中的广播地址，路由器不转发网络广播地址。
                子网广播地址：具体子网的广播地址，它仅将数据包发送到相应无类别子网内部的所有节点上。
                全子网广播地址：可以将数据包以广播方式发送到由该标准网络划分的所有子网节点上。
                有限广播：地址设为255.255.255.255。是在ID未知情况下，使用有限广播地址来进行本地网络或子网内部所有节点传送。IPv4节点通常仅在自动化配置过程中使用有限广播地址，如DHCP服务。

        8.1.6 IPv4地址前缀表示形式
            A类地址1-126,网络长度8位
            B类地址128-191,网络长度16位
            C类地址192-223,网络长度24位
            IPv4地址/网络ID

        8.1.7 几种特殊的IPv4地址
            （1）私网IP地址
                10.0.0.0/8(10.0.0.0 255.0.0.0)
                172.16.0.0/12(172.16.0.0 255.240.0.0)
                192.168.0.0/16(192.168.0.0 255.255.0.0)
            （2）169开头的IPv4地址
                自动专用IP地址
                169.254.0.0/16
            （3）127.0.0.1
                环回地址。是主机IP堆栈内部的IPv4地址，主要用于网络软件测试以及本地机进程间通信。
            （4）0.0.0.0地址
                在默认路由时，代表所有不清楚路由的目的主机和目的网络。
                在网络配置中，代表整个网络，即网络中所有主机。

    8.2 IPv4子网划分与聚合
        8.2.1 VLSM子网划分的基本思想
            思想：把原来标准网络IPv4地址中的网络ID部分向主机部分借位。
            VLSM可以划分的子网数是2^n个（n为子网ID位数，就是向原来主机借的位数）
        8.2.2 全0子网与全1子网
        8.2.3 VLSM子网划分方法
        8.2.4 VLSM子网划分示例
        8.2.5 子网聚合方法和示例
            CIDR(无类别域间路由)：把一些连续的多个小子网络路由汇总成一条大网络路由，实现这些小子网间的路由，最终实现减少路由表中的路由条目和提高路由性能的目的。
            子网聚合的标准网络或者子网必须是连续的。

            聚合方法：把每个子网的网络地址用二进制列出来，找到完全相同的连续位，即可得到新网络的子网掩码。

    8.3 IPv4 NAT基础
        NAT(network address translation，网络地址转换)
        8.3.1 NAT的主要应用
            （1）无足够的公网IP地址可用时
            （2）重构网络IP地址部署
            （3）实现简单的TCP负载均衡
        8.3.2 与NAT相关的主要术语
            （1）内部网络
                可以是注册的IP地址，也可以是非注册的私网IP地址
            （2）外部网络
                外部网络上的用户使用的IP地址可以是注册的，也可以是非注册的
            （3）本地地址
                内部本地地址
                外部本地地址
            （4）全局地址
                内部全局地址
                外部全局地址
        8.3.3 NAT地址基本转换原理
        8.3.4 NAT类型
            静态NAT：一对一的映射到公网注册的IP地址
            动态NAT：映射到一个注册IP地址池中的一个地址
            重载或复用NAT:与IP地址的不同端口组合，把多个非注册IP地址映射到一个注册的IP地址（PAT，端口地址转换）
            重叠NAT：当内部网络IP地址是外部注册的IP地址时，路由器维护一张查询表，截取内部网络数据包，用外部网络没有使用的注册IP地址进行替换。

    8.4 IPv6地址基础
        8.4.1 IPv6地址表示形式
            基本的冒号十六进制表示形式
            前导零省略表示形式
            压缩零表示形式
        8.4.2 IPv6地址中的二进制与十六进制转换
    8.5 IPv6地址类型
        8.5.1 单播地址
            全局单播地址：等同于IPv4中的公网地址
            IPv6本地单播地址：等同于IPv4中的局域网地址
                链路本地地址：链路本地地址等效于169.254.0.0/16网段的自动专用IP寻址IPv4地址
                站点本地地址：相当于IPv4中的局域网专用地址
                内嵌IPv4地址的IPv6单播地址
                    IPv4地址兼容地址
                    IPv4映射IPv6本地单播地址
                    6to4地址
                两种特殊的单播地址
                    未指定地址（0:0:0:0:0:0:0:0或::）等价于IPv4未指定地址0.0.0.0
                    环回地址（0:0:0:0:0:0:0:1或::1）等价于IPv4环回地址127.0.0.1
        8.5.2 组播地址
        8.5.3 任播地址
        8.5.4 IPv6主机和路由器地址
        8.5.5 IPv6地址前缀表示形式
    8.6 IPv6地址自动配置
        8.6.1 IPv6地址自动配置的类型
            无状态的自动配置
            监控状态的自动配置
            两者兼备的自动配置
        8.6.2 自动配置过程

第九章：路由协议及工作原理
    9.1 RIP路由协议
        RIP(routing information protocol，路由信息协议)
        9.1.1 RIP路由度量机制
            理解跳数
                RIP采用距离矢量路由算法
            度量更新规则
                仅接收度量值更小或相等的更新，忽略度量值比原来的值更大的路由更新
        9.1.2 RIP路由更新机制
            RIP路由定期更新机制
        9.1.3 RIP路由收敛机制
            计数到无穷大机制
            水平分割法
            毒性逆转水平分割法
            保持定时器法
        9.1.4 RIP报文格式
            使用UDP在邻居路由器间交换路由表，端口号为502
            RIPv1广播报文
            RIPv2组播报文，组播地址224.0.0.9
            30秒向邻居路由器发送一次路由更新报文，180秒没有收到来自对端的路由更新报文则标志路由信息为不可达，240秒未收到更新报文将路由删除。
    9.2 OSPF路由协议
        OSPF(open shortest path first，开放式最短路径优先协议)
        9.2.1 OSPF协议简介
            (1)采用链路状态路由算法
            (2)可划分不同区域
            (3)有不同路由角色
            (4)收敛性能更高
        9.2.2 OSPF的AS与Area
            理解AS
                AS是一组使用相同路由协议交换路由信息的路由器，又称路由域。
                同一个AS中所有路由器必须相互连接，运行相同路由协议，同时分配同一个AS号

                只有在同一个AS中路由器才会相互交换链路状态信息
                同一个AS中，所有OSPF路由器都维护一个相同AS结构描述的数据库
                该数据库存放相应链路的状态信息
                OSPF根据数据库计算OSPF路由表
                OSPF将一个AS分割成多个小的区域，便于网络扩展
                每个OSPF在区域内部学习完整的链路状态信息，便于路由更新管理
            理解Area
                为了减小LSDB（链路状态数据库）大小，降低SPF（最短路径优先）运算的系统资源开销，减少路由表项数OSPF允许被划分成多个连续网络群组，这就是区域（Area）
        9.2.3 OSPF网络路由器类型
            （1）内部路由器
                运行其所属区域的OSPF运算法则，生成区域内部的路由表项
            （2）区域边界路由器
                运行与其相连区域定义的OSPF法则，具有连接的每一个区域的网络结构数据，并且连接如何将该区域的链路状态信息通告至骨干区域，再由骨干区域转发至其余区域。
            （3）AS边界路由器
                在AS内部通告其所得到的AS外部路由信息。
            （4）骨干路由器
        9.2.4 DR和BDR
            DR和BDR的主要作用
                DR集中负责一个区域内各路由器间的LSU交换和邻接关系建立，相当于这个区域的发责任一样。
                负责集中管理、维护和组播下发区域内各路由器发来的链路状态信息。
                DR或BDR通常处于一个区域的中心地位。BDR用于DB失效后接替DR工作。
                在OSPF区域中，每个路由器都和DR、BDR相连。
            DR和BDR的选举
                DR通过接口优先级进行选举，最高级的路由器被选为DR，次高者被选为BDR；
                如果接口优先级相同，就按router-id进行选举，由最大到次大选举DR、BDR.
                选举一旦完成，即使新加一个优先级更高的设备也不会进行重新选举，除非DR或者BDR出现问题。
        9.2.5 OSPF LSA类型
            链路状态通告（LSA）分类：
                （1）Type1：路由器LSA
                    由区域内所有路由器产生，并且只能在本区域内泛洪通告。
                    路由器LSA描述了路由器物理接口所连接的链路或接口，指明链路状态开销等参数
                （2）Type2：网络LSA
                    由DR或者BDR产生，报文包括DR和BDR连接的路由器的链路信息，描述了一个多路访问网络所有相连的路由器。第二类LSA也只能在产生的区域内泛洪。
                （3）Type3：网络汇总LSA
                    由ABR产生的，报文包通知本区域内的路由器通往区域外的路由信息。
                    如果一台ABR路由器经过骨干区域从其他ABR路由器收到多条网络汇总LSA，那么会选择最低代价的LSA
                （4）Type4：ASBR汇总LSA
                    由ABR发出，是一条主机路由，即指向ASBR路由器地址的路由。
                （5）Type5：自治系统外部LSA
                    由ASBR产生的，告诉相同自治系统路由器通往外部自治区的路径。
                    自治系统外部LSA是唯一不和具体的区域相关的LSA通告，将在整个自治系统中泛洪。
                （6）Type6：组成员LSA
                    该类通告很少，不支持组播OSPF协议
                （7）Type7：NSSA外部LSA
                    由ASBR产生的，内容与LSA5几乎相同的，但NSSA外部LSA通告仅在始发这个NSSA外部LSA通告的非纯stub区域内部进行泛洪。
        9.2.6 Backbone（骨干）区域
            OSPF网络中包含区域：骨干区域（backbone area）、末梢区域（stub area）、 非纯stub区域（no stotal stub area，NSSA）

            OSPF至少有一个骨干区域，ID为0.0.0.0，称为区域0。主要工作是在其余区域间传递路由信息
        9.2.7 stub（末梢区域）
            stub区域属于OSPF网络末端，由一些处理能力有限的低端路由器组成。
        9.2.8 totally stub区域和NSSA区域
        9.2.9 OSPF路由计算过程
            （1）建立邻接关系
            （2）DR/BDR选举
            （3）发送LSA
            （4）创建路由表
            （5）维护路由表
        9.2.10 OSPF报头格式
            OSPF报文主要分为：
                Hello报文：用来发现OSPF邻居并维持OSPF邻居关系的报文。
                DD（database description，数据库描述）报文：用来描述本路由器的链路状态数据库（LSDB），进行数据库同步的。
                LSR（link state request，链路状态请求）报文：当两台路由器交换完DD报文后，知道对端路由器有哪些LSA是本LSDBB所没有的，以及哪些LSA已经失效，需要发送一个LSR报文，向对方请求所需的LSA。
                LSU（link state update，链路状态更新）报文：用来向对端路由器发送所需的LSA。
                LSAck（Link state acknowledgement，链路状态应答）报文：路由器收到对端发来的LSU报文后所发出的确认应答报文、内容是需要确认的LSA头部。
            OSPF报文格式：
                version：版本号
                packet type：报文类型字段，标识对应报文的类型。
                package length：包长度
                router id：路由器id
                area id：区域id
                checksum：校验和字段
                AuType：认证类型字段
                Authentication：认证字段
    9.3 IS-IS路由协议
        IS-IS(intermediate system to intermediate system，中间系统到中间系统)
        9.3.1 ISO网络基础
            无连接网络服务（CLNS,connectionless network service）
                无连接网络协议（CLNP,connectionless network protocol）
            面向连接网络服务（CONS,connection-oriented network service）
                面向连接协议（CONP,connection-oriented network protocol）

            提供CLNS服务有CLMP、IS-IS和ES-IS
                （1）CLNP
                （2）IS-IS
                    OSPF仅支持IP协议，专为TCP/IP网络设计
                    IS-IS能够同时处理多个网络层协议（如IP何CLNP）
                （3）ES-IS
        9.3.2 IS-IS路由协议基本术语
            （1）IS(intermediate system，中间系统)
                就是TCP/IP网络中的路由器
            （2）ES(end system，终端系统)
                相当于TCP/IP网络中的主机系统
            （3）RD(routing domain，路由域)
                多个IS-IS协议的路由器组成的范围
            （4）area(区域)
                IS-IS路由域的细分单元
            （5）LSDB(link state database，链路状态数据库)
                网络内所有链路的状态构成了LSDB，在每一个IS中都至少有一个LSDB，
                IS使用SPF算法，利用LSDB生成自己的路由
            （6）LSPDU(link state protocol data unit，链路状态协议数据单元)
                描述本路由器的链路状态信息
            （7）DIS(designated IS，指定IS)
                在广播或多路方式在网络上选举的，作为中间系统。
            （8）NSAP(network service access point，网络服务接入点)
                用来标识一个抽象的网络服务访问点，描述OSI模型的网络地址结构。
                其分为两大部分：IDP域间部分和DSP域内服务部分。
            （9）PDU(packet data unit，报文数据单元)
                链路数据层传递的数据报文格式。
                分为Hello PDU、LS PDU、CSN PDU、PSN PDU。
                IS-IS协议直接承载在数据链路层上不需要经过三层协议封装。
                OSPF协议承载在IP协议之上。
            （10）Sys ID(system id，系统id)
                标识唯一一台中间系统。
            （11）NET(network entity title，网络实体标题)
                特殊的NSAP地址
            （12）IIH(IS to IS hello PDU，IS到IS间的Hello PDU)
                进行邻居的发现、建立和维护。
            （13）PSNP(partial sequence number PDU，部分序列号数据包)
                用于确认链路数据信息。
            （14）CSNP(complete sequence number PDU，完全序列号数据包)
                用于发布完整的链路数据信息。
        9.3.3 IS-IS路由及路由器类型
            ISO网络中的路由选择级别
                Level-0：ES与IS之间的路由
                Level-1：同一区域IS之间的路由
                Level-2：不同区域IS间路由
                Level-3：不同IS-IS域间的路由
            IS-IS路由器类型
                L1路由器：IS-IS区域内的路由器
                L2路由器：两个IS-IS区域间的路由器
                L1/L2路由器：同时属于L1/L2路由器
        9.3.4 IS-IS与OSPF区域及路由器邻接关系比较
            IS-IS工作在数据链路层
            OSPF工作在应用层，报文需要IP包格式进行封装

            不同方面有：
            （1）IS-IS可以有多个骨干区域
                非骨干区域（通过L1/L2路由器）直接与骨干（L2路由器）相连
            （2）区域边界不同
            （3）不同区域间路由器的邻接关系不同
        9.3.5 IS-IS PDU报头格式
            IS-IS网络使用的PDU主要有：
                IIH(IS-IS hello，IS-IS hello包)
                LSP(link-state package，链路状态包)
                SNP(sequence number package，序列号包)

            通用报头格式说明：
                intradomain routing protocoldiscriminator：域内路由选择协议鉴别符，用于标识网络层PDU的类型
                length-indicator：长度标识符
                version、protocol id extension：版本/协议id扩展
                id length：id长度，用于标识NSAP和NET地址长度
                PDU type：PDU类型
                version：版本
                reserved：保留位
                maximum area address：最多区域地址，标识支持的最大区域数
        9.3.6 IIH PDU包格式
            用于建立和维持IS-IS路由器之间的邻接关系。
            包括IS-IS PDU通用报头、IIH专用报头和可变字段三部分。
            IIH专用报头部分包括发送者的系统ID、分配的区域地址和发送路由器已知的链路上邻居标识。

            IIH有以下三种类型
                Level-1 LAN IS-IS Hello PDU（类型号15）：广播网中L1路由器发送的IIH
                Level-2 LAN IS-IS Hello PDU（类型号16）：广播网中L2路由器发送的IIH
                点到点IS-IS Hello PDU（类型号17）：点对点网络上路由器发送的IIH

            报头含义
               reserved：保留字段
               circuit type：电路类型字段，0x01表示L1路由器，0x10表示L2路由器，0x11表示L1/L2路由器。
               source id：源ID字段。标识发送该IIH PDU包的源路由器SysID（系统ID）
               holding time：保持时间。用来通知它的邻居路由器在认为这台路由器失效之前应用等待的时间。
               PDU length：PDU报文长度
               priority：优先级字段，标识本路由器在DIS选举中的优先级。
               LAN ID：局域网ID字段
               local circuit id：标识本地链路id
        9.3.7 LSP PDU包格式
            用来承载和泛洪路由器的链路状态信息
            LSP分为：
                Level-1 LSP（类型号为18）：由Level-1路由器产生，在Level-1区域泛洪
                Level-2 LSP（类型号为20）：由Level-2路由器产生，在Level-2子域泛洪
            LSP报头字段：
                PDU length：PDU长度。
                remaining lifetime：剩余生存时间字段。标识此LSP到期的生存时间。
                LSP ID：用于标识不同的LSP和生成LSP的源路由器。其包括SysID、伪节点标识符和LSP编号三部分
                sequence number：标识每个LSP包的序列号
                checksum：用于接收端校验所传送LSP的完整性和正确性
                P：分区字段，表示区域划分或者分段区域的修复位
                ATT：区域关联字段，表示产生此LSP的路由器与多个区域相连。
                OL：超载字段，表示本路由器因内在不足而导致LSDB不完整。
                IS type：路由类型字段
        9.3.8 SNP PDU包格式
            SNP包含一个或多个LSP的汇总描述，用于确认邻居之间最新接收的LSP，作用类似于确认报文。
            SNP分为CSNP(完整SNP)和PSNP(部分SNP)
            报头字段：
                PDU length：PDU报文长度
                source id：标识发送该CSNP PDU的路由器SysID
                start LSP ID：描述LSP范围中第一个LSP ID号
                end LSP ID：描述LSP范围中最后一个LSP ID号
        9.3.9 IS-IS PDU可变字段格式
            可变字段部分就是各种PDU包真正内容部分，是整个PDU包的核心部分。
            字段说明：
                code：代码字段，标识PDU类型。
                length：长度字段，标识value字段长度
                value：值字段，表示实际承载的PDU内容
        9.3.10 IS-IS的两种地址格式
            NSAP地址格式
                标识网络层服务，每一种服务对应一个NSAP地址。

                NSAP地址由两部分组成：
                IDP(inter-domain portion，域间部分)相当于ip地址的主网络部分
                    AFI(authority and format id，机构与格式id)：用来标识地址格式和对应地址的分配机构
                    IDI(inter-domain id，域间id)：用来标识、区分AFI字段下不同的域。
                DSP(domain service portion，域服务部分)相当于ip地址中子网id、主机id和端口号总和
                    HODSP(high order DSP，DSP高位)：用来在一个域中分割多个区域，相当于ip地址中的子网id部分
                    SID(system id，系统id)：用来区分主机，通常以MAC地址进行标识，相当于ip地址中的主机id部分
                    NSEL(network-selector，网络选择器)：用来指定选定的服务，相当于TCP协议中的端口号
            NET地址格式
                用来唯一地表示IS-IS路由选择域中的OSI主机，路由器使用NET地址来标识自己
                NET地址分为：区域地址（area address）、系统id（system id）和NSEL（网络选择器）
        9.3.11 IS-IS与OSPF的比较
        9.3.12 IS-IS最短路径计算和路由表生成原理
            IS-IS最短路径计算原理
            IS-IS路由表的生成原理
    9.4 BGP
        BGP(border gateway protocol，边界网关协议)
        是一个包含独立路由策略的分离路由域间的无环路路由协议
        主要用于大型网络和ISP运营商

        9.4.1 BGP概述
            BGP是一个设计在组织网络间（也就是路由域间，或者说是路由域边界）提供无环路的域间路由协议。
            使用可靠的传输协议TCP179号端口（这是目的端口，本地端口可以随意）来传输BGP通信。
            BGP主要用于连接一个本地网络到外部网络，以访问Internet或者其他公司网络。
            使用路径矢量路由算法

            具有以下特征：
                是一种外部网关协议，OSPF、RIP属于内部网关协议，其着眼点不在于发现和计算路由，而是控制路由的传播和选择最佳路由。
                使用TCP传输协议
                支持CIDR无类别域间路由
                路由更新时BGP只发送更新路由，减少BGP传播所占用的带宽，适用于在Internet上传播大量路由信息
                BGP路由通过携带AS路径信息彻底解决路由环路问题
                提供丰富的路由策略，能够对路由实现灵活的过滤和选择
                易于扩展，能够适应网络新发展
        9.4.2 BGP AS
            （1）BGP AS号格式
                Asplain（无格式AS）
                Asdot（点分AS）
            （2）保留和私有的AS号
                私有AS号可以用于内部路由域，但不能传输到达Internet的通信
        9.4.3 BGP地址簇模型
        9.4.4 BGP speaker和peer的关系
        9.4.5 BGP peer会话建立
            状态更改：空闲-连接-活动-打开发送-打开接收-建立
        9.4.6 BGP的路由属性
            四类属性：
                公认必须遵循
                公认可选
                可选过滤
                可选非过滤
            属性：
                （1）源属性（ORIGIN）
                    定义路由信息的来源，标记一条路由是怎么成为BGP路由的
                    IGP:优先级最高，路由产生于本AS内
                    EGP:优先级次之，路由通过EGP学到
                    incomplete:优先级最低，路由来源无法确定
                （2）AS路径属性（AS_PATH）
                    按一定次序记录了某条路由从本地到目的地址所要经过的所有AS号
                （3）下一跳属性（NEXT_HOP）
                （4）MED（MULTI_EXIT_DISC）
                    多出口度量，用于判断进入AS时的最佳路由
                （5）本地优先属性（LOCAL_PREF）
                    用于判断流量离开AS时最佳路由
                （6）团体属性（COMMUNITY）
                    用于简化路由策略的应用和降低维护管理的难度
        9.4.7 BGP的消息类型及报文格式
            报头字段：
                marker：标明BGP报文边界，相当于一个报文的头部标识符
                length：标识BGP消息总长度
                type：标识BGP消息类型
            五种消息报文格式：
                open消息报文格式
                    open消息是TCP连接建立后发生的第一个消息，用于建立BGP对等体之间的连接关系
                    字段：
                        version：版本
                        my autonomous system：本地AS字段，标识本地AS号
                        hold time：保持时间
                        BGP identifier：BGP标识符
                        opt Parma len：可选参数长度
                        optional parameter：可选参数，用于多协议扩展
                update消息报文格式
                    update消息用于在对等体之间交换路由信息，既可以发布可达路由信息，也可以撤销不可达路由信息
                    字段：
                        UNfeasible routes length：不可达路由字段长度
                        withrawn route：不可达路由列表
                        total path attribute length：路径属性字段的长度
                        path attribute：与NLRI相关的所有路径属性列表
                        NLRI：可达路由的前缀和前缀长度二元组
                notification消息及报文格式
                    当BGP检测到错误状态时，就像对等体发出notification消息
                    字段：
                        error code：差错码
                        error subcode：差错字码
                        data：错误消息内容
                keepalive消息报文格式
                    保持活跃消息，用于保持连接的有效性
                route-refresh消息报文格式
                    用来要求对等体重新发送指定地址簇的路由信息。
                    字段：
                        AFI：address family identifier，地址簇标识，用于标识所采用的地址簇类型
                        Res：保留
                        SAFI：subsequent address family identifier，子地址簇标识，用于标识子地址簇类型

第十章：传输层
    10.1传输层概述
        10.1.1 划分传输层的必要性
            物理层为数据通信提供实际的物理线路和通信信道，是任何数据通信的基础。
            数据链路层为同一网络中的数据通信提供了虚拟的通信通道，可以根据不同链路类型对物理层的比特流进行帧封装和传输。
            网络层为不同网络间的数据通信提供了数据包的路由、转发功能，把数据包从一个网络中的主机传送到位于另一个网络中的目的主机上。

            传输层为每一个网络应用配备一个唯一的应用进程标识，通过不同端口为不同的应用进程提供服务。
        10.1.2 传输层的端到端传输服务
            点到点连接就是通信双方直接通过电缆进行连接，中间没有经过其他任何设备。
            端到端连接是两个终端系统之间的连接，体现在两个终端系统的连接中时要经过一个或多个设备。

            端到端传输经过中间设备时不需要进行存储转发，无须建立多条传输链路，因此传输延时小。
            点到点传输采用存储转发技术进行缓冲。
        10.1.3 传输层服务
            传输层的服务类型
                面向连接服务TCP
                无连接服务UDP
            服务等级
                A类：具有低的连接差错率和故障率，是可靠的传输服务，一般指在虚电路网络上
                B类：具有低的连接差错控制率和故障率，传输服务质量中等，应用于广域网和互联网中的传输层协议多数属于这一类
                C类：具有较高的连接差错率和故障率，服务质量较差，提供数据服务或无线电分组交换网所提供的传输层协议均属于此类。
            传输层协议类别
                TP0-TP3属于面向连接的传输层协议，发送数据前必须先建立传输连接
                TP4既可以是面向连接的传输层协议，也可以是无连接的传输层协议
        10.1.4 TSAP和TPDU
            TSAP(传输服务访问点)
                为了确保所有传输地址在整个网络中唯一，因此将传输地址分成网络ID、主机ID及主机分配的端口三部分。
                总共65535个对应传输层协议端口，前1024个端口称为常规端口
                例如：80号TCP端口分配给了WWW服务使用，将23号TCP端口分配给了Telnet服务使用，将21号TCP端口分配给了FTP服务使用
            TPDU(传输协议数据单元)
                LI：标识整个TPDU头部的长度
                固定部分：包括TPDU代码和常用参数，其内容对于某一特定的TPDU来说是固定的，包括目的端口和源端口等，但对于不同传输层协议的TPDU也是不一样的
                可变部分：包含一些可选参数。每个参数由code、length和value组成。
        10.1.5 传输连接建立阶段的主要TPDU
            CR TPDU
                代码：标识TPDU类型
                CDT：表示能接受的TPDU序号的上限值
                目的参考：该传输连接的目的对等传输实体用来唯一标识这一连接的标识符，也就是对端传输连接序号。
                源参考：本地传输连接标识符
                类别选项：占8位，高4位标识使用的传输层协议类型，低4位可选项。
            CC TPDU
        10.1.6 数据传输阶段的主要TPDU
            DT TPDU
                代码：标识TPDU类型
                TPDU序列号和EOT
            AK TPDU
                代码：标识TPDU类型
                CDT：信用量分配，用于流浪控制
                目的参考：数据传输源端的传输连接序号
                你的TPDU序列号：表明所期望接收的下一个DT TPDU的序列号。
            END TPDU
            EA TPDU
        10.1.7 传输连接释放阶段的TPDU
            DR TPDU-断开连接请求
            DC TPDU-断开连接确认
        10.1.8 传输服务原语
            一个简单的传输服务原语模型
                监听、连接、发送、接收、断开连接
            ISO规范中的传输服务原语
                各层服务原语分为4种类型：请求、指示、响应、确认

    10.2 传输层服务功能
        完成8个基本功能：传输层寻址、传输层连接建立、数据传输、传输连接释放、流量控制、拥塞控制、多路复用和解复用、崩溃恢复。
        10.2.1 传输层寻址方案
            进程服务器的TSAP地址分配方案
                使用一个特殊的进程服务器来集中为那些较少使用的服务提供监听代理功能。
            名称服务器的TSAP地址分配方案--DNS服务器
                名称服务器总是在监听一个特定的知名服务的端口。
        10.2.2 传输连接建立
            正常传输连接的建立
            传输连接拒绝
        10.2.3 重复传输连接的解决方法
            （1）非重复TSAP
                系统为每次连接赋予一个新的TSAP地址，当连接被释放时将此TSAP废弃
            （2）过时连接表
                为每个连接分配连接标识符，每新建一个传输连接，序列号增加1，并且存入到每个TPDU中
            （3）分组的TTL机制
                先定义和计数每个分组的生存时间TTL，如果因超时未达目的地，则视为陈旧分组，将被抛弃
            （4）三次握手机制
        10.2.4 数据传输
            ISO规定了正常数据传输和加速数据传输两种类型服务
        10.2.5 传输连接释放
            传输连接的释放分为对称释放和非对称释放两种。
        10.2.6 流量控制
            原则：发送端收到了来自接收端的主机多少个确认TPDU，就可以继续发送多少个DTP TPDU，发送窗口大小不是固定的。
        10.2.7 多路复用
            向上多路复用：多个传输连接复用一个网络连接
            向下多路复用：一个传输连接在多个网络连接上循环传输
        10.2.8 崩溃恢复
            从第N层崩溃中恢复只能由第N+1层来完成，并且只能在第N+1层留有足够状态信息的情况下才能完成
    10.3 TCP概述
        TCP(传输控制协议)
        10.3.1 TCP的主要特性
            （1）面向连接的传输协议
            （2）仅支持单播传输
            （3）提供可靠的交付服务
            （4）传输单位为数据段
            （5）仅一种TPDU
            （6）支持全双工传输
            （7）TCP连接是基于字节流的，而非报文流
            （8）每次发送的TCP数据段大小和数据段数都是可变的
        10.3.2 TCP数据段格式
            数据段的大小：
                一是每个TCP数据段的大小必须符合IP数据包的65535字节的有效荷载大小限制要求
                二是每个网络都有一个MTU值。
            字段：
                （1）源端口和目的端口
                    代表呼叫方和被呼叫方的TCP端口号
                （2）序号
                    指TCP数据段中数据部分的第一个字节的编号
                （3）确认号
                    指期望接收到对方下一个数据段中数据部分非第一个字节序号
                （4）数据偏移
                    指数据段中数据部分起始处距离TCP数据段起始处的字节偏移量
                （5）保留
                （6）URG
                    紧急指针控制位，指出当前数据段中是否有紧急数据
                    紧急数据会优先安排传输
                （7）ACK
                    确认控制位，指示TCP数据段中的确认号字段是否有效
                （8）PSH
                    推控制位，指示是否需要立即把收到的该数据段提交给应用进程
                （9）RST
                    重置控制位，用于重置、释放一个已经混乱的传输连接，然后重建新的传输连接
                （10）SYN
                    同步控制位，用来在传输连接建立时同步传输连接序号。
                    SYN为1，表示这是一个连接请求或连接确认报文
                    SYN为1，ACK为0，表明这是一个连接请求数据段
                    SYN为1，ACK为1，对方同意建立连接
                （11）FIN
                    最后控制位，用于释放一个传输连接
                    正常传输位置为0
                    FIN为1时，表示数据已经全部传输完成。
                （12）窗口大小
                    指示发送此TCP数据段的主机上用来存储传入数据段的窗口大小，也即发送者当前还可以接收的最大字节数。
                （13）校验和
                    对“数据段头”、“数据”、“伪头部”这三部分进行校验
                （14）紧急指针
                    URG为1才有意义。指出本数据段中为紧急数据的字节数。
                    紧急数据无须缓存，窗口大小为0时也可以发送
                （15）可选项
                    可以包括窗口缩放选项、最大数据段大小选项、选择性确认选项、时间戳选项等。
                （16）数据
                    应用层的应用程序提交的数据。
        10.3.3 TCP套接字
            套接字概述
                socket是两个网络应用程序进行通信连接时的一个端点，它是连接应用程序和网络驱动程序的桥梁。
                TSAP位于传输层上边缘，而socket是完全位于应用层，但它调用了传输层的端口。
            socket原语
        10.3.4 TCP端口
            共有65535个端口
            TCP和UDP是两个独立的软件模块，因此各自端口号相互独立。
            TCP端口的三大类：
               （1）保留端口
                    0-1023号端口称为常规端口
                    这些端口基本上已经分配给了已知的网络应用协议。
               （2）动态分配端口
                    通过查看某个端口是否被占用可以了解当前系统是否中了某一种木马程序。
               （3）注册端口
                    某个软件开发的应用程序，如CCProxy中的8080号端口
        10.3.5 TCP连接的状态转移
        10.3.6 TCP传输连接的建立
            单方主动连接的TCP连接建立过程
                TCP建立在不可靠的分组传输服务之上，协议具有超时和重传机制。
            双方同时主动连接的TCP连接建立
                最终只有一个连接能够建立起来
        10.3.7 TCP传输连接的释放
            单方主动关闭的TCP连接释放过程
            双方主动关闭 的TCP连接释放流程
    10.4 TCP的可靠性传输
        4种机制：
            （1）字节编号机制
            （2）数据段确认机制
            （3）超时重传机制
            （4）选择性确认机制--重传缺少部分的数据，而不会重传那些已经正确接收的数据。
        10.4.1 TCP的数据确认机制
            特性：
                （1）TCP可一次连续发送多个数据段
                    TCP不需要等待对方发送的确认数据段就可以一次连续发送多个数据段。
                    一次发送多少数据段受窗口大小限制。（对方返回的窗口大小和当前可用窗口大小双重限制）
                （2）仅对连续接收的数据段进行确认
                （3）不连续序号的数据将先缓存
                    不连续的数据段先缓存在接收窗口中，等待接收到中断的数据后再一起提交。
                    不能及时提交的数据，需要占用接收窗口空间。
        10.4.2 TCP超时重传机制
            超时重传计时器
            SRTT的计算
                超时时间
                SRTT（新的SRTT）=aSRTT（旧的SRTT值）+（1-a）RTT（新的RTT值）
                a是一个平滑因子，a典型值为0.125
            RTO的计算
                RTT定时器到后等待时间
        10.4.3 TCP的选择确认机制
           发送端通过识别接收端返回确认数据段中的SACK扩展选项可以得知接收端已经收到哪些不连续序号的数据段，
           这样发送端就可以不再发送这些数据段，而只发送已经丢失的数据段。
    10.5 TCP的流量控制
        10.5.1 TCP的流量控制简介
            滑动窗口

            持续计时器：当收到窗口大小为0时启动计时器，定时器到期后发生一个小的探测数据段。
        10.5.2 基于传输效率的考虑
            Nagle算法
            Clark算法
    10.6 TCP的拥塞控制
        10.6.1 TCP拥塞控制简介
        10.6.2 TCP拥塞控制
            （1）慢启动
                每次发送的数据大小是逐渐增大的，直到达到某个极限值为止
            （2）拥塞避免
            （3）快速重传、快速恢复
    10.7 UDP概述
        不面向连接的传输层--UDP(user datagram protocol，用户数据报文协议)
        10.7.1 UDP的基础知识
           UDP的特性：
            （1）无连接性
            （2）不可靠性
            （3）以报文为边界
                UDP是报文流，而TCP是字节流
            （4）无流量控制和拥塞控制功能
            （5）支持各种交互通信方式
                TCP不支持组播、广播通信方式，只支持一对一的单播方式，UDP支持各种通信方式
            服务包括DNS、SNMP、DHCP和RIP等。
        10.7.2 UDP数据报头部格式
            （1）源端口
                源主机UDP端口
            （2）目的端口
                目的主机UDP端口
                如果目的主机应用层没有对应端口的应用进程，则该UDP数据报会被丢弃
            （3）长度
            （4）校验和
                在进行校验和计算时，需要在UDP数据报头部前加上12个字节的伪头部。
            （5）数据

第十一章：应用层
    11.1 应用层概述
        11.1.1 应用层组件及典型应用服务
            OSI/RM
                应用服务组件（ASE）的3个重要组件：
                    ACSE（关联控制服务组件）：使通信两端应用程序关联起来，用于在两端应用程序之间建立、维护和终止连接
                    ROSE（远程操作服务组件）：采用类似远程过程调用的请求、应答机制实现远程操作
                    RTSE（可靠传输服务组件）：使用会话层活动管理服务来管理数据分段的传输
                5种不同网络应用类型：
                    MHS(报文处理系统)
                    FTAM(文件传输、存取和管理)
                    VTP(虚拟终端协议)
                    DS(目录服务)
                    TP(事物处理)
                    RDA(远程数据库访问)
            TCP/IP
                支持协议
                    域名服务系统（DNS）
                    动态主机配置协议（DHCP）
                    简单网络管理协议（SNMP）
                应用服务
                    WEB浏览服务--超文本传输协议（HTTP）
                    e-mail服务--简单邮件传输协议（SMTP）
                    文件传输访问服务--文件传输协议（FTP）、简单文件传输协议（TFTP）
                    远程登录服务--远程登录（Telnet）
        11.1.2 应用层的C/S服务模型
    11.2 Web服务基础
        WEB服务核心应用层协议（HTTP）
        11.2.1 Web服务模型
            web服务提供者（服务器）
            web服务请求者（客户端）
            web服务注册中心（互联网注册、管理机构）
                指互联网注册、管理中心和提供网站域名解析的ISP（Internet服务提供商）。
                在局域网内部的网站访问中无须使用此部分，负责互联网网站的注册和管理，并向用户提供互联网域名解析服务。
        11.2.2 万维网的全球统一标识
            3中标识
                （1）URL(统一资源定位器)
                    <协议>://<主机名>:<端口>/<路径>
                    协议：包括HTTP、FTP、Gopher、Telnet、File、Mailto等
                    主机：web服务器名称
                    端口：传输层端口号，如果采用常规协议，端口号可以省略，直接使用默认端口号。如HTTP默认端口号80
                    路径：指定web服务器上的文件路径
                （2）URI(统一资源标识符)
                （3）URN(统一资源名称)
        11.2.3 万维网文档标记
        11.2.4 HTML文档类型
        11.2.5 HTML文档的三超属性
            超文本
            超媒体
            超链接
        11.2.6 HTTP服务访问基本流程
            HTTP是一个面向文本的应用层协议
            使用服务端口是TCP的80端口
            当用户关闭对应网站时，对应的网站TCP传输连接才关闭--持续连接服务
        11.2.7 HTTP的主要特性
            （1）客户端/服务器模型（C/S）
                C/S模式是所有网络应用服务采用的通用模式
            （2）无连接
                直接利用TCP传输即可，不需要建立会话连接
            （3）高可靠
            （4）无状态
            （5）简单快速
        11.2.8 HTTP请求报文格式
            （1）请求行
            （2）请求头部行
            （3）空行
            （4）实体主体行
                不能在GET方法中使用，仅在POST方法中用于向服务器提供一些用户凭据信息
        11.2.9 HTTP响应报文格式
            （1）响应行
            （2）响应头部行
            （3）空行
            （4）实体主体行
    11.3 DNS服务
        域名服务
        11.3.1 DNS技术的引入背景
            IP地址标识的不足
                （1）不便记忆
                （2）不方便地址变更
                （3）不安全
            host文件名称解析方案
                （1）名称冲突在所难免
                （2）少数名称解析服务器难以承受
            DNS名称解析方案
                首先该应用程序调用一个解析器，使它成为DNS客户，将该主机名作为DNS请求报文参数，以UDP用户
                数据报方式发送给本地DNS服务器，本地DNS服务器查找该主机名，并且将找到的IP地址放在响应报文
                中返回给解析器。解析器再将IP地址返回给调用解析器的应用程序。
        11.3.2 DNS命名方案的设计思想
            名称冲突的解决方案
                DNS域名，最右边是顶级域名，左边代表子域名。
            解析性能不足的解决方案
                采取分布式管理，每一级域名由少数DNS服务器单独进行解析
        11.3.3 DNS名称空间
            顶级和二级域名由对应的互联网域名管理机构颁布
            顶级域名
                三大类：
                    国家或地区类：cn中国、us美国、jp日本
                    通用类：商业类com、教育类edu、政府类gov、国际组织int、网络供应商net、非盈利组织org
                    近期新增的通用类：biz商业组织、film公司企业、store商店、web、arts文化娱乐组织
            二级域名
            三级域名
        11.3.4 DNS名称服务器
            DNS服务器的分区管理
            DNS服务器种类
                （1）根域名服务器
                    管理顶级域名
                    全球共有13套，每套只有1个主根名称服务器，名称为a.rootserver.net--m.rootserver.net
                （2）顶级名称服务器
                （3）权威名称服务器
                （4）本地名称服务器
        11.3.5 DNS报文格式
            请求报文和应答报文总体格式一样。
            报头部分：
                ID：查询报文序号
                QR：报文类型标志，请求报文为0，应答报文为1
                OPcode：操作码标志位，用于设置查询种类。0为标准查询，1为反向查询，2为服务器状态查询
                AA：授权应答标志位。
                TC：截断标志位，1为超出报文最大长度已被分段
                RD：期望递归标志位。
                RA：支持递归标志位
                Rcode：应答码标志位。0无错误，1格式错误，2服务器原因无法解析，3域名不存在，4不支持所请求的查询，5服务器设置策略拒绝回答
                QDcount：问题条数
                ANcount：资源记录数
                NScount：名称服务器资源记录数
                ARcount：资源记录数
            请求消息格式
                QName：表示所请求解析的域名
                QType：查询资源记录类型
                   AXFR：代表完整区域的域名解析请求
                   MAILB：代表与邮箱相关的资源记录
                   MAILA：代表邮件代理资源记录
                   * ：代表所有资源记录请求
                QClass：表示查询类别
            资源记录格式
                NAME：资源记录对应的域名
                TTL：资源记录可以缓存的时间
                TYPE：资源记录类型
                CLASS：资源记录数据的类别
                RDLength：字段长度
                RData：具体的相关资源记录
        11.3.6 DNS数据传输方式
            通过C/S模式，分为DNS服务器和DNS客户端
            报文通过TCP53号端口传输，也可以通过UDP53号端口传输
            数据大于512字节时使用TCP传输
        11.3.7 DNS递归解析原理
        11.3.8 DNS迭代解析原理
    11.4  DHCP服务
        动态主机配置协议
        11.4.1 BOOTP和DHCP简介
            BOOTP是一个基于IP和UDP的协议，可以让无盘站点从一个中心服务器上获得IP地址。
            DHCP是BOOTP的增强版本，基于IP和UDP。
                DHCP服务器不用配置客户端MAC地址，利用租约技术提高IP地址的使用效率和安全性。
        11.4.2 DHCP服务的主要功能及应用环境
            DHCP服务主要功能
                IP地址自动分配
                通过IP地址与MAC地址绑定功能实现静态IP地址的分配。
                配置客户端的DNS服务器、WINS服务器（windows操作系统的DHCP服务器）和默认网关
                利用IP地址排除功能，使已分配给其他主机的IP地址不再分配给其他客户端
                通过DHCP中继功能，一个DHCP服务器可以为多个网段（或VLAN）中的DHCP客户端分配不同地址池中的IP地址，进一步简化网络中的IP地址配置工作
            使用DHCP服务的好处
                减少TCP/IP配置和管理的工作量
                方便客户端移动
                配置更加可靠
            DHCP服务的主要应用环境
                网络规模较大
                网络中主机数目大于该网络支持的IP地址数量
                网络中只有少数主机需要固定IP地址，大多数主机没有固定的IP地址需求
        11.4.3 DHCP报文及其格式
            工作在C/S模式中。DHCP客户端使用UDP68端口，DHCP服务器使用UDP67号端口。
            DHCP报文类型
            DHCP报文格式
                OP：DHCP报文操作类型
                Htype、Hlen：分别制定DHCP客户端的MAC地址类型和长度
                Hops：DHCP报文经过的DHCP中继的数目
                Xid：请求标识
                Secs：客户端从获取IP地址或续约过程开始到现在所消耗的时间
                Flags：标志位，第一位为广播标志位，其余位保留
                Ciaddr：指示DHCP客户端的IP地址
                Yiaddr：指示DHCP服务器分配给客户端的IP地址
                Siaddr：指示下一个为DHCP客户端分配IP地址等信息的DHCP服务器地址
                Giaddr：指示DHCP客户端发出请求报文后经过的第一个DHCP中继的IP地址
                Chaddr：指示DHCP客户端的MAC地址
                Sname：指示DHCP客户端分配IP地址的DHCP服务器名称
                File：指示DHCP服务器为DHCP客户端指定的启动配置文件名称及路径信息
                Options：可选项字段，长度可变
                    包括报文类型、有效租约期、续约时间、子网掩码、默认网关、DNS服务器、域名称、WINS服务器等。
        11.4.4 DHCP服务的IP地址自动分配原理
            （1）发现阶段
                DHCP DISCOVER寻找DHCP服务器
                传输层通过UDP68号端口发送，经过网络层IP封装后，源地址为0.0.0.0，目的地址255.255.255.255（有限广播地址）
            （2）提供阶段
                网络中所有DHCP服务器收到客户端DHCP DISCOVER报文后，会根据自己地址池中IP地址分配的优先次序选出一个IP地址，然后与其他参数通过UDP67号端口，
                在DHCP OFFER报文中以广播方式发送给客户端。客户端通过封装在帧中的目的地址MAC地址的比对过程来确定是否接受该帧。
                服务器一起发送的还有子网掩码、默认网关、租约时间、WINS服务器地址和NetBIOS节点类型。
            （3）选择阶段
                多台DHCP服务器向该客户端发送DHCP OFFER报文，客户端只接受第一个报文，然后以广播方式发送DHCP REQUEST报文。
                该报文中包含预分配的IP地址、对应DHCP服务器IP地址等，这样相当于告诉其他DHCP服务器可以释放已提供的地址，并将这些地址返回到可用地址池中。
            （4）确认阶段
                DHCP服务器收到DHCP REQUEST报文如果确认将地址分配给该客户端，则以广播方式返回DHCP ACK报文，否则返回DHCP NAK报文。

                客户端收到DHCP ACK报文会以广播方式发送免费ARP报文（源IP和目标IP地址都是本机IP地址，源MAC地址是本机MAC地址，目的MAC地址是广播MAC地址），
                探测是否有主机使用服务器分配的IP地址，如果在规定时间没有收到回应，客户端才使用该地址，否则客户端会发生DHCP DECLING报文给服务器，并重新申请IP地址。
        11.4.5 DHCP服务的IP地址租约更新原理
            （1）DHCP客户端在IP地址租期期限达到1/2时，向DHCP服务器以单播方式发送DHCP REQUEST请求报文，以期进行IP租约的更新
            （2）DHCP服务器同意续约，以单播方式返回DHCP ACK报文，客户端获得新IP租约，否则返回DHCP NAK报文不能续租。
            （3）续约失败，在租约期限达到7/8时，再次以广播方式发送DHCP REQUEST请求报文进行续约。
        11.4.6 DHCP中继代理
            与DHCP服务器不在同一个子网的DHCP客户端可以通过DHCP中继代理与其他网段的DHCP服务器通信。
            DHCP中继代理位于DHCP客户端和DHCP服务器之间，负责广播DHCP报文转发。
            （1）DHCP中继代理简介
                option 82选项
            （2）通过DHCP中继代理动态分配IP地址的原理
    11.5 电子邮件服务
        11.5.1 电子邮件系统的基本结构
            基于C/S模式
            邮件服务器转发、保存功能
            发送邮件协议SMTP（简单邮件传输协议）、邮件接收服务协议POP3（邮局协议3）
            SMTP使用TCP25
            POP3使用TCP110
        11.5.2 电子邮件消息格式
            （1）RFC2822电子邮件消息格式
            （2）MIME电子邮件消息格式
        11.5.3 SMTP请求命令和应答消息
        11.5.4 SMTP服务的工作原理
        11.5.5 POP3请求命令及应答消息
        11.5.6 POP3服务器的工作原理
        11.5.7 IMAP4简介
            工作在TCP143号端口
            特性：
            （1）支持服务器副本存储
            （2）支持离线、在线和断线3种访问方式
            （3）支持多个客户同时连接到一个邮箱
            （4）支持选择性获取
            （5）支持在用户邮箱上创建、管理多个文件夹功能
            （6）支持服务器搜索
            （7）支持客户端和服务器间的拖动操作